# ë°±ì—”ë“œ ì—°ë™ ê°€ì´ë“œ (Supabase)

## ğŸ“‹ ì „ì²´ ë¡œë“œë§µ

```
1. Supabase í”„ë¡œì íŠ¸ ì„¤ì • (30ë¶„)
   â†“
2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„± (1ì‹œê°„)
   â†“
3. Next.js í”„ë¡œì íŠ¸ì— Supabase ì—°ë™ (30ë¶„)
   â†“
4. ì¹´ì¹´ì˜¤ OAuth ì„¤ì • (1ì‹œê°„)
   â†“
5. ì¸ì¦ ê¸°ëŠ¥ êµ¬í˜„ (2ì‹œê°„)
   â†“
6. ì„¤ë¬¸ CRUD êµ¬í˜„ (3ì‹œê°„)
   â†“
7. ì‘ë‹µ ê¸°ëŠ¥ êµ¬í˜„ (2ì‹œê°„)
   â†“
8. í†µê³„/ê²°ê³¼ ê¸°ëŠ¥ êµ¬í˜„ (2ì‹œê°„)
   â†“
9. ë§ˆì´í˜ì´ì§€ ì—°ë™ (1.5ì‹œê°„)
   â†“
10. ê´€ë¦¬ì ê¸°ëŠ¥ êµ¬í˜„ (1ì‹œê°„)
   â†“
11. í…ŒìŠ¤íŠ¸ & ë””ë²„ê¹… (2ì‹œê°„)
```

**ì˜ˆìƒ ì´ ì†Œìš”ì‹œê°„: 15~17ì‹œê°„**

---

## 1ë‹¨ê³„: Supabase í”„ë¡œì íŠ¸ ì„¤ì • (30ë¶„)

### 1.1 Supabase ê³„ì • ìƒì„±
1. https://supabase.com ì ‘ì†
2. "Start your project" í´ë¦­
3. GitHub ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
4. ë¬´ë£Œ í”Œëœ ì„ íƒ

### 1.2 ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
1. "New Project" í´ë¦­
2. í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥:
   - Name: `stur-vey`
   - Database Password: ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ (ì €ì¥ í•„ìˆ˜!)
   - Region: `Northeast Asia (Seoul)` ì„ íƒ
   - Pricing Plan: Free
3. "Create new project" í´ë¦­
4. í”„ë¡œì íŠ¸ ìƒì„± ëŒ€ê¸° (2~3ë¶„)

### 1.3 API í‚¤ í™•ì¸
1. í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œ â†’ Settings â†’ API
2. ë‹¤ìŒ ì •ë³´ ë³µì‚¬ (ë‚˜ì¤‘ì— ì‚¬ìš©):
   - Project URL: `https://xxxxx.supabase.co`
   - `anon` public key
   - `service_role` secret key (ê´€ë¦¬ììš©, ì¡°ì‹¬!)

---

## 2ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„± (1ì‹œê°„)

### 2.1 SQL Editor ì—´ê¸°
1. Supabase ëŒ€ì‹œë³´ë“œ â†’ SQL Editor
2. "New query" í´ë¦­

### 2.2 í…Œì´ë¸” ìƒì„± SQL ì‹¤í–‰
`docs/database-schema.md` íŒŒì¼ì˜ SQLì„ **ìˆœì„œëŒ€ë¡œ** ì‹¤í–‰:

#### Step 1: profiles í…Œì´ë¸”
```sql
-- docs/database-schema.md ì°¸ê³ 
CREATE TABLE profiles (...);
CREATE OR REPLACE FUNCTION handle_new_user() ...;
CREATE TRIGGER on_auth_user_created ...;
```

#### Step 2: surveys í…Œì´ë¸”
```sql
CREATE TABLE surveys (...);
```

#### Step 3: questions í…Œì´ë¸”
```sql
CREATE TABLE questions (...);
```

#### Step 4: question_options í…Œì´ë¸”
```sql
CREATE TABLE question_options (...);
```

#### Step 5: responses í…Œì´ë¸”
```sql
CREATE TABLE responses (...);
```

#### Step 6: answers í…Œì´ë¸”
```sql
CREATE TABLE answers (...);
```

#### Step 7: RLS ì •ì±…
```sql
-- ê° í…Œì´ë¸”ë³„ RLS ì •ì±… ì ìš©
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
CREATE POLICY "..." ON profiles ...;
-- (ë‚˜ë¨¸ì§€ ì •ì±…ë“¤ë„ ìˆœì„œëŒ€ë¡œ)
```

### 2.3 í…Œì´ë¸” í™•ì¸
1. Table Editorì—ì„œ ëª¨ë“  í…Œì´ë¸” ìƒì„± í™•ì¸
2. ê° í…Œì´ë¸”ì˜ ì»¬ëŸ¼, íƒ€ì… í™•ì¸

---

## 3ë‹¨ê³„: Next.js í”„ë¡œì íŠ¸ì— Supabase ì—°ë™ (30ë¶„)

### 3.1 Supabase íŒ¨í‚¤ì§€ ì„¤ì¹˜
```powershell
npm install @supabase/supabase-js @supabase/ssr
```

### 3.2 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
`.env.local` íŒŒì¼ ìƒì„±:
```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxx...
SUPABASE_SERVICE_ROLE_KEY=eyJxxx...
```

âš ï¸ **ì£¼ì˜**: `.env.local`ì€ `.gitignore`ì— ì¶”ê°€ (GitHubì— ì˜¬ë¦¬ì§€ ë§ ê²ƒ!)

### 3.3 Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±

#### `lib/supabase/client.js` (ë¸Œë¼ìš°ì €ìš©)
```javascript
import { createBrowserClient } from '@supabase/ssr';

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
  );
}
```

#### `lib/supabase/server.js` (ì„œë²„ìš©)
```javascript
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';

export function createClient() {
  const cookieStore = cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
    {
      cookies: {
        get(name) {
          return cookieStore.get(name)?.value;
        },
      },
    }
  );
}
```

#### `lib/supabase/middleware.js` (ë¯¸ë“¤ì›¨ì–´ìš©)
```javascript
import { createServerClient } from '@supabase/ssr';
import { NextResponse } from 'next/server';

export async function updateSession(request) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
    {
      cookies: {
        get(name) {
          return request.cookies.get(name)?.value;
        },
        set(name, value, options) {
          request.cookies.set({ name, value, ...options });
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          response.cookies.set({ name, value, ...options });
        },
        remove(name, options) {
          request.cookies.set({ name, value: '', ...options });
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          response.cookies.set({ name, value: '', ...options });
        },
      },
    }
  );

  await supabase.auth.getUser();

  return response;
}
```

### 3.4 ë¯¸ë“¤ì›¨ì–´ ì„¤ì •

#### `middleware.js` (ë£¨íŠ¸ì— ìƒì„±)
```javascript
import { updateSession } from '@/lib/supabase/middleware';

export async function middleware(request) {
  return await updateSession(request);
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};
```

### 3.5 ì—°ê²° í…ŒìŠ¤íŠ¸

#### `app/test/page.js` ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)
```javascript
import { createClient } from '@/lib/supabase/server';

export default async function TestPage() {
  const supabase = createClient();
  
  // í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬
  const { data, error } = await supabase
    .from('profiles')
    .select('*')
    .limit(1);

  return (
    <div>
      <h1>Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
      {error ? (
        <p style={{ color: 'red' }}>ì—ëŸ¬: {error.message}</p>
      ) : (
        <pre>{JSON.stringify(data, null, 2)}</pre>
      )}
    </div>
  );
}
```

http://localhost:3000/test ì ‘ì†í•˜ì—¬ ì—°ê²° í™•ì¸

---

## 4ë‹¨ê³„: ì¹´ì¹´ì˜¤ OAuth ì„¤ì • (1ì‹œê°„)

### 4.1 ì¹´ì¹´ì˜¤ ê°œë°œì ê³„ì • ìƒì„±
1. https://developers.kakao.com ì ‘ì†
2. ì¹´ì¹´ì˜¤ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
3. ê°œë°œì ë“±ë¡

### 4.2 ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±
1. "ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜" â†’ "ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€í•˜ê¸°"
2. ì•± ì´ë¦„: "Stur-vey"
3. ì‚¬ì—…ìëª…: ê°œì¸ ì´ë¦„ ì…ë ¥

### 4.3 ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™œì„±í™”
1. ì•± ì„¤ì • â†’ í”Œë«í¼ â†’ Web í”Œë«í¼ ë“±ë¡
   - ì‚¬ì´íŠ¸ ë„ë©”ì¸: `http://localhost:3000` (ê°œë°œìš©)
2. ì œí’ˆ ì„¤ì • â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ í™œì„±í™” ì„¤ì •: ON
3. **Redirect URI ë“±ë¡** (ì¤‘ìš”!):
   ```
   http://localhost:3000/api/auth/callback
   ```
   - "ë“±ë¡" ë²„íŠ¼ í´ë¦­í•˜ì—¬ ì¶”ê°€
   - ë‚˜ì¤‘ì— Supabase Callback URLë„ ì—¬ê¸°ì— ì¶”ê°€ ì˜ˆì •
   
4. **Client Secret ì„¤ì •** (ì„ íƒì‚¬í•­):
   - ê¸°ë³¸ê°’: "ì‚¬ìš© ì•ˆ í•¨" ê·¸ëŒ€ë¡œ ë‘ê¸°
   - REST APIì—ì„œëŠ” í•„ìˆ˜ê°€ ì•„ë‹˜

### 4.4 ë™ì˜ í•­ëª© ì„¤ì •
1. ì œí’ˆ ì„¤ì • â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ ë™ì˜ í•­ëª©
2. í•„ìš”í•œ í•­ëª© ì„ íƒ:
   - ë‹‰ë„¤ì„: í•„ìˆ˜ ë™ì˜
   - ì¹´ì¹´ì˜¤ê³„ì •(ì´ë©”ì¼): í•„ìˆ˜ ë™ì˜
   - í”„ë¡œí•„ ì‚¬ì§„: ì„ íƒ ë™ì˜

### 4.5 REST API í‚¤ í™•ì¸
1. ì•± ì„¤ì • â†’ ì•± í‚¤
2. **REST API í‚¤** ë³µì‚¬ (ì˜ˆ: `1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p`)
   - ì´ í‚¤ë¥¼ Supabaseì— ì…ë ¥í•  ì˜ˆì •

### 4.6 Supabaseì— ì¹´ì¹´ì˜¤ OAuth ì„¤ì •
1. **Supabase ëŒ€ì‹œë³´ë“œ** â†’ **Authentication** â†’ **Providers**
2. **Kakao** ì°¾ì•„ì„œ **Enable** í´ë¦­
3. ì¹´ì¹´ì˜¤ ì •ë³´ ì…ë ¥:
   - **Kakao client ID**: ì¹´ì¹´ì˜¤ì˜ **REST API í‚¤** ë¶™ì—¬ë„£ê¸°
   - **Kakao client secret**: **ë¹„ì›Œë‘ê¸°** (ì‚¬ìš© ì•ˆ í•¨)
4. **Callback URL (for OAuth)** í™•ì¸ ë° ë³µì‚¬:
   ```
   https://qsflfobkvansdnjnjjki.supabase.co/auth/v1/callback
   ```
5. **Save** í´ë¦­

### 4.7 ì¹´ì¹´ì˜¤ì— Supabase Callback URL ì¶”ê°€
1. ë‹¤ì‹œ **ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†”**ë¡œ ì´ë™
2. ì œí’ˆ ì„¤ì • â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ **Redirect URI**
3. Supabase Callback URL ì¶”ê°€:
   ```
   https://qsflfobkvansdnjnjjki.supabase.co/auth/v1/callback
   ```
4. "ë“±ë¡" ë²„íŠ¼ í´ë¦­

ì´ì œ ì´ **2ê°œì˜ Redirect URI**ê°€ ë“±ë¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:
- âœ… `http://localhost:3000/api/auth/callback` (ê°œë°œìš©)
- âœ… `https://qsflfobkvansdnjnjjki.supabase.co/auth/v1/callback` (Supabase)

### 4.8 í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€ (ì„ íƒì‚¬í•­)
`.env.local`ì— ì¶”ê°€:
```env
NEXT_PUBLIC_KAKAO_REST_API_KEY=ì¹´ì¹´ì˜¤_REST_API_í‚¤
```

---

## 5ë‹¨ê³„: ì¸ì¦ ê¸°ëŠ¥ êµ¬í˜„ (2ì‹œê°„)

### 5.1 Auth Context ìƒì„±

#### `contexts/AuthContext.js`
```javascript
'use client';

import { createContext, useContext, useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

const AuthContext = createContext({});

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const supabase = createClient();

  useEffect(() => {
    // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
    supabase.auth.getUser().then(({ data: { user } }) => {
      setUser(user);
      setLoading(false);
    });

    // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setUser(session?.user ?? null);
        setLoading(false);
      }
    );

    return () => subscription.unsubscribe();
  }, []);

  const signInWithKakao = async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'kakao',
      options: {
        redirectTo: `${window.location.origin}/api/auth/callback`,
      },
    });
    if (error) console.error('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—ëŸ¬:', error);
  };

  const signOut = async () => {
    const { error } = await supabase.auth.signOut();
    if (error) console.error('ë¡œê·¸ì•„ì›ƒ ì—ëŸ¬:', error);
  };

  return (
    <AuthContext.Provider value={{ user, loading, signInWithKakao, signOut }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
```

### 5.2 ë£¨íŠ¸ ë ˆì´ì•„ì›ƒì— Provider ì¶”ê°€

#### `app/layout.js` ìˆ˜ì •
```javascript
import { AuthProvider } from '@/contexts/AuthContext';

export default function RootLayout({ children }) {
  return (
    <html lang="ko">
      <body>
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  );
}
```

### 5.3 Auth Callback Route ìƒì„±

#### `app/api/auth/callback/route.js`
```javascript
import { createClient } from '@/lib/supabase/server';
import { NextResponse } from 'next/server';

export async function GET(request) {
  const { searchParams, origin } = new URL(request.url);
  const code = searchParams.get('code');
  const next = searchParams.get('next') ?? '/';

  if (code) {
    const supabase = createClient();
    const { error } = await supabase.auth.exchangeCodeForSession(code);
    
    if (!error) {
      return NextResponse.redirect(`${origin}${next}`);
    }
  }

  // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
  return NextResponse.redirect(`${origin}/login`);
}
```

### 5.4 ë¡œê·¸ì¸ í˜ì´ì§€ ìˆ˜ì •

#### `app/(auth)/login/page.js`
```javascript
'use client';

import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';
import Button from '@/components/common/Button';
import styles from './page.module.css';

export default function LoginPage() {
  const { user, signInWithKakao } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (user) {
      router.push('/');
    }
  }, [user, router]);

  return (
    <div className={styles.container}>
      <div className={styles.loginBox}>
        <h1>Stur-vey</h1>
        <p>í•™ìƒ ì„¤ë¬¸ì¡°ì‚¬ í”Œë«í¼</p>
        <Button onClick={signInWithKakao} size="large">
          ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°
        </Button>
      </div>
    </div>
  );
}
```

### 5.5 íšŒì›ê°€ì… í˜ì´ì§€ ìˆ˜ì •

#### `app/(auth)/signup/page.js`
```javascript
'use client';

import { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
import Button from '@/components/common/Button';
import styles from './page.module.css';

export default function SignupPage() {
  const { user } = useAuth();
  const router = useRouter();
  const [nickname, setNickname] = useState('');
  const [school, setSchool] = useState('');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!user) {
      router.push('/login');
    }
  }, [user, router]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    const supabase = createClient();
    const { error } = await supabase
      .from('profiles')
      .update({ nickname, school_name: school })
      .eq('id', user.id);

    if (error) {
      alert('í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨: ' + error.message);
    } else {
      router.push('/');
    }
    setLoading(false);
  };

  return (
    <div className={styles.container}>
      <div className={styles.signupBox}>
        <h1>í”„ë¡œí•„ ì„¤ì •</h1>
        <form onSubmit={handleSubmit} className={styles.form}>
          <div className={styles.formGroup}>
            <label>ë‹‰ë„¤ì„ *</label>
            <input
              type="text"
              value={nickname}
              onChange={(e) => setNickname(e.target.value)}
              required
              maxLength={20}
            />
          </div>
          <div className={styles.formGroup}>
            <label>í•™êµëª… *</label>
            <input
              type="text"
              value={school}
              onChange={(e) => setSchool(e.target.value)}
              required
              maxLength={50}
            />
          </div>
          <Button type="submit" size="large" disabled={loading}>
            {loading ? 'ì €ì¥ ì¤‘...' : 'ì™„ë£Œ'}
          </Button>
        </form>
      </div>
    </div>
  );
}
```

### 5.6 Header ì»´í¬ë„ŒíŠ¸ì— ì¸ì¦ ìƒíƒœ ë°˜ì˜

#### `components/common/Header.js` ìˆ˜ì •
```javascript
'use client';

import { useAuth } from '@/contexts/AuthContext';
import Link from 'next/link';
import Button from './Button';
import styles from './Header.module.css';

export default function Header() {
  const { user, signOut } = useAuth();

  return (
    <header className={styles.header}>
      {/* ... ê¸°ì¡´ ì½”ë“œ ... */}
      
      <div className={styles.authButtons}>
        {user ? (
          <>
            <Link href="/my">
              <Button variant="secondary" size="small">ë§ˆì´í˜ì´ì§€</Button>
            </Link>
            <Button variant="secondary" size="small" onClick={signOut}>
              ë¡œê·¸ì•„ì›ƒ
            </Button>
          </>
        ) : (
          <Link href="/login">
            <Button size="small">ë¡œê·¸ì¸</Button>
          </Link>
        )}
      </div>
    </header>
  );
}
```

---

## 6ë‹¨ê³„: ì„¤ë¬¸ CRUD êµ¬í˜„ (3ì‹œê°„)

### 6.1 ì„¤ë¬¸ ëª©ë¡ ì¡°íšŒ

#### `app/(main)/surveys/page.js` ìˆ˜ì •
```javascript
import { createClient } from '@/lib/supabase/server';
import SurveyCard from '@/components/survey/SurveyCard';
import styles from './page.module.css';

export default async function SurveysPage() {
  const supabase = createClient();
  
  const { data: surveys, error } = await supabase
    .from('surveys')
    .select(`
      *,
      profiles:author_id (nickname),
      responses (count)
    `)
    .eq('is_active', true)
    .order('created_at', { ascending: false });

  if (error) {
    return <div>ì—ëŸ¬: {error.message}</div>;
  }

  return (
    <div className={styles.container}>
      <h1 className={styles.title}>ì „ì²´ ì„¤ë¬¸</h1>
      <div className={styles.surveyGrid}>
        {surveys?.map(survey => (
          <SurveyCard key={survey.id} survey={survey} />
        ))}
      </div>
    </div>
  );
}
```

### 6.2 ì„¤ë¬¸ ìƒì„±

#### `app/(main)/surveys/create/page.js` ìˆ˜ì •
```javascript
'use client';

import { useState } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
// ... ê¸°ì¡´ import

export default function CreateSurveyPage() {
  const { user } = useAuth();
  const router = useRouter();
  // ... ê¸°ì¡´ state

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!user) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
      router.push('/login');
      return;
    }

    const supabase = createClient();

    // 1. ì„¤ë¬¸ ìƒì„±
    const { data: survey, error: surveyError } = await supabase
      .from('surveys')
      .insert({
        title,
        description,
        category,
        end_date: endDate,
        author_id: user.id,
      })
      .select()
      .single();

    if (surveyError) {
      alert('ì„¤ë¬¸ ìƒì„± ì‹¤íŒ¨: ' + surveyError.message);
      return;
    }

    // 2. ì§ˆë¬¸ë“¤ ìƒì„±
    for (const [index, question] of questions.entries()) {
      const { data: q, error: qError } = await supabase
        .from('questions')
        .insert({
          survey_id: survey.id,
          question_text: question.text,
          question_type: question.type,
          order_number: index + 1,
        })
        .select()
        .single();

      if (qError) {
        alert('ì§ˆë¬¸ ìƒì„± ì‹¤íŒ¨: ' + qError.message);
        return;
      }

      // 3. ì„ íƒì§€ ìƒì„± (ê°ê´€ì‹ì¸ ê²½ìš°)
      if (question.type === 'multiple' || question.type === 'checkbox') {
        const options = question.options.map((opt, i) => ({
          question_id: q.id,
          option_text: opt,
          order_number: i + 1,
        }));

        const { error: optError } = await supabase
          .from('question_options')
          .insert(options);

        if (optError) {
          alert('ì„ íƒì§€ ìƒì„± ì‹¤íŒ¨: ' + optError.message);
          return;
        }
      }
    }

    alert('ì„¤ë¬¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
    router.push(`/surveys/${survey.id}`);
  };

  // ... ê¸°ì¡´ JSX
}
```

### 6.3 ì„¤ë¬¸ ìƒì„¸ ì¡°íšŒ

#### `app/(main)/surveys/[id]/page.js` ìˆ˜ì •
```javascript
import { createClient } from '@/lib/supabase/server';
// ... ê¸°ì¡´ import

export default async function SurveyDetailPage({ params }) {
  const supabase = createClient();
  
  // ì„¤ë¬¸ ì •ë³´ ì¡°íšŒ
  const { data: survey, error } = await supabase
    .from('surveys')
    .select(`
      *,
      profiles:author_id (nickname),
      questions (
        *,
        question_options (*)
      )
    `)
    .eq('id', params.id)
    .single();

  if (error || !survey) {
    return <div>ì„¤ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>;
  }

  // ... ì‘ë‹µ í¼ ë Œë”ë§
}
```

### 6.4 ì„¤ë¬¸ ìˆ˜ì • & ì‚­ì œ

#### `app/(main)/surveys/[id]/edit/page.js`
```javascript
'use client';

// ... ê¸°ì¡´ ì½”ë“œ ...

const handleUpdate = async (e) => {
  e.preventDefault();
  
  const supabase = createClient();
  
  // ì„¤ë¬¸ ì—…ë°ì´íŠ¸
  const { error } = await supabase
    .from('surveys')
    .update({ title, description, category, end_date: endDate })
    .eq('id', params.id);

  if (error) {
    alert('ìˆ˜ì • ì‹¤íŒ¨: ' + error.message);
  } else {
    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
    router.push(`/surveys/${params.id}`);
  }
};

const handleDelete = async () => {
  if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  const supabase = createClient();
  
  const { error } = await supabase
    .from('surveys')
    .update({ is_active: false })
    .eq('id', params.id);

  if (error) {
    alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
  } else {
    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
    router.push('/my/created');
  }
};
```

---

## 7ë‹¨ê³„: ì‘ë‹µ ê¸°ëŠ¥ êµ¬í˜„ (2ì‹œê°„)

### 7.1 ì‘ë‹µ ì œì¶œ

#### `app/(main)/surveys/[id]/page.js` - Client Componentë¡œ ë³€ê²½
```javascript
'use client';

import { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { createClient } from '@/lib/supabase/client';
// ... imports

export default function SurveyDetailPage({ params }) {
  const { user } = useAuth();
  const [survey, setSurvey] = useState(null);
  const [responses, setResponses] = useState({});
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadSurvey();
  }, [params.id]);

  const loadSurvey = async () => {
    const supabase = createClient();
    const { data } = await supabase
      .from('surveys')
      .select(`
        *,
        profiles:author_id (nickname),
        questions (
          *,
          question_options (*)
        )
      `)
      .eq('id', params.id)
      .single();

    setSurvey(data);
    setLoading(false);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!user) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
      return;
    }

    const supabase = createClient();

    // 1. ì‘ë‹µ ë ˆì½”ë“œ ìƒì„±
    const { data: response, error: responseError } = await supabase
      .from('responses')
      .insert({
        survey_id: params.id,
        user_id: user.id,
      })
      .select()
      .single();

    if (responseError) {
      alert('ì‘ë‹µ ì œì¶œ ì‹¤íŒ¨: ' + responseError.message);
      return;
    }

    // 2. ê° ì§ˆë¬¸ë³„ ë‹µë³€ ì €ì¥
    const answers = Object.entries(responses).map(([questionId, answer]) => {
      const question = survey.questions.find(q => q.id === parseInt(questionId));
      
      if (question.question_type === 'multiple') {
        // ê°ê´€ì‹ ë‹¨ì¼ ì„ íƒ
        return {
          response_id: response.id,
          question_id: parseInt(questionId),
          selected_option: answer,
        };
      } else if (question.question_type === 'checkbox') {
        // ê°ê´€ì‹ ë³µìˆ˜ ì„ íƒ
        return answer.map(opt => ({
          response_id: response.id,
          question_id: parseInt(questionId),
          selected_option: opt,
        }));
      } else {
        // ì£¼ê´€ì‹
        return {
          response_id: response.id,
          question_id: parseInt(questionId),
          text_answer: answer,
        };
      }
    }).flat();

    const { error: answersError } = await supabase
      .from('answers')
      .insert(answers);

    if (answersError) {
      alert('ë‹µë³€ ì €ì¥ ì‹¤íŒ¨: ' + answersError.message);
      return;
    }

    alert('ì‘ë‹µì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');
    router.push('/surveys');
  };

  // ... JSX
}
```

---

## 8ë‹¨ê³„: í†µê³„/ê²°ê³¼ ê¸°ëŠ¥ êµ¬í˜„ (3ì‹œê°„)

### 8.1 ì‘ë‹µ ì§‘ê³„ ë° ê²°ê³¼ í˜ì´ì§€ êµ¬í˜„

#### `app/(main)/surveys/[id]/results/page.js`
```javascript
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import styles from './page.module.css';

export default async function SurveyResultsPage({ params }) {
  const supabase = createClient();
  const surveyId = (await params).id;

  // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  const { data: { user } } = await supabase.auth.getUser();

  // ì„¤ë¬¸ ì •ë³´ ì¡°íšŒ
  const { data: survey, error: surveyError } = await supabase
    .from('surveys')
    .select(`
      *,
      profiles:author_id (nickname),
      questions (
        id,
        question_text,
        question_type,
        question_order,
        question_options (
          id,
          option_text,
          option_order
        )
      )
    `)
    .eq('id', surveyId)
    .single();

  if (surveyError || !survey) {
    return <div className={styles.error}>ì„¤ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>;
  }

  // ê²°ê³¼ ì¡°íšŒ ê¶Œí•œ í™•ì¸
  const isAuthor = user?.id === survey.author_id;
  
  // ì‚¬ìš©ìê°€ ì‘ë‹µí–ˆëŠ”ì§€ í™•ì¸
  const { data: userResponse } = user ? await supabase
    .from('responses')
    .select('id')
    .eq('survey_id', surveyId)
    .eq('respondent_id', user.id)
    .single() : { data: null };

  const hasResponded = !!userResponse;

  // ê¶Œí•œ ì²´í¬: ì‘ì„±ìì´ê±°ë‚˜, result_visibilityê°€ 'public'ì´ê±°ë‚˜, ì‘ë‹µì
  const canViewResults = isAuthor || 
                         survey.result_visibility === 'public' || 
                         (survey.result_visibility === 'respondents' && hasResponded);

  if (!canViewResults) {
    return (
      <div className={styles.accessDenied}>
        <h2>ê²°ê³¼ ì—´ëŒ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
        <p>
          {survey.result_visibility === 'respondents' 
            ? 'ì„¤ë¬¸ì— ì‘ë‹µí•œ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' 
            : 'ì„¤ë¬¸ ì‘ì„±ìë§Œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'}
        </p>
      </div>
    );
  }

  // ì´ ì‘ë‹µ ìˆ˜
  const { count: totalResponses } = await supabase
    .from('responses')
    .select('*', { count: 'exact', head: true })
    .eq('survey_id', surveyId);

  // ì§ˆë¬¸ ìˆœì„œëŒ€ë¡œ ì •ë ¬
  const sortedQuestions = [...survey.questions].sort((a, b) => a.question_order - b.question_order);

  // ê° ì§ˆë¬¸ë³„ í†µê³„
  const questionsWithStats = await Promise.all(
    sortedQuestions.map(async (question) => {
      // ì„ íƒì§€ ìˆœì„œëŒ€ë¡œ ì •ë ¬
      const sortedOptions = question.question_options 
        ? [...question.question_options].sort((a, b) => a.option_order - b.option_order)
        : [];

      if (question.question_type === 'multiple' || question.question_type === 'checkbox') {
        // ê°ê´€ì‹: ì„ íƒì§€ë³„ ê°œìˆ˜ ì§‘ê³„
        const stats = await Promise.all(
          sortedOptions.map(async (option) => {
            const { count } = await supabase
              .from('answers')
              .select('*', { count: 'exact', head: true })
              .eq('question_id', question.id)
              .eq('selected_option_id', option.id);

            return {
              option_text: option.option_text,
              count: count || 0,
              percentage: totalResponses > 0 ? ((count || 0) / totalResponses * 100).toFixed(1) : 0,
            };
          })
        );

        return { 
          ...question, 
          question_options: sortedOptions,
          stats 
        };
      } else if (question.question_type === 'text') {
        // ì£¼ê´€ì‹: ëª¨ë“  ë‹µë³€ ê°€ì ¸ì˜¤ê¸°
        const { data: textAnswers } = await supabase
          .from('answers')
          .select('text_answer, created_at')
          .eq('question_id', question.id)
          .not('text_answer', 'is', null)
          .order('created_at', { ascending: false });

        return {
          ...question,
          textResponses: textAnswers || [],
        };
      }

      return question;
    })
  );

  // ë§ˆê° ì—¬ë¶€ í™•ì¸
  const isClosed = new Date(survey.deadline) < new Date();

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <div className={styles.headerTop}>
          <h1 className={styles.title}>{survey.title}</h1>
          <span className={styles.category}>{survey.category}</span>
        </div>
        <p className={styles.description}>{survey.description}</p>
        <div className={styles.meta}>
          <span>ğŸ‘¤ {survey.profiles?.nickname || 'ìµëª…'}</span>
          <span>ğŸ“… ë§ˆê°: {new Date(survey.deadline).toLocaleDateString('ko-KR')}</span>
          <span className={styles.status}>
            {isClosed ? 'ğŸ”’ ë§ˆê°ë¨' : 'âœ… ì§„í–‰ì¤‘'}
          </span>
        </div>
      </div>

      <div className={styles.statsBox}>
        <h2>ğŸ“Š ì‘ë‹µ í˜„í™©</h2>
        <div className={styles.statsGrid}>
          <div className={styles.statItem}>
            <span className={styles.statNumber}>{totalResponses || 0}</span>
            <span className={styles.statLabel}>ì´ ì‘ë‹µ ìˆ˜</span>
          </div>
          {survey.max_responses && (
            <div className={styles.statItem}>
              <span className={styles.statNumber}>
                {survey.max_responses - (totalResponses || 0)}
              </span>
              <span className={styles.statLabel}>ë‚¨ì€ ì¸ì›</span>
            </div>
          )}
        </div>
      </div>

      <div className={styles.results}>
        <h2>ì§ˆë¬¸ë³„ ê²°ê³¼</h2>
        
        {questionsWithStats.map((question, index) => (
          <div key={question.id} className={styles.questionResult}>
            <h3 className={styles.questionTitle}>
              Q{index + 1}. {question.question_text}
              <span className={styles.questionType}>
                {question.question_type === 'multiple' ? 'ê°ê´€ì‹(ë‹¨ì¼)' : 
                 question.question_type === 'checkbox' ? 'ê°ê´€ì‹(ë³µìˆ˜)' : 
                 'ì£¼ê´€ì‹'}
              </span>
            </h3>

            {(question.question_type === 'multiple' || question.question_type === 'checkbox') && (
              <div className={styles.chartContainer}>
                {question.stats?.map((stat, i) => (
                  <div key={i} className={styles.chartBar}>
                    <div className={styles.barLabel}>
                      <span>{stat.option_text}</span>
                      <span className={styles.barStats}>
                        {stat.count}ëª… ({stat.percentage}%)
                      </span>
                    </div>
                    <div className={styles.barBackground}>
                      <div 
                        className={styles.barFill}
                        style={{ width: `${stat.percentage}%` }}
                      />
                    </div>
                  </div>
                ))}
              </div>
            )}

            {question.question_type === 'text' && (
              <div className={styles.textResponses}>
                {question.textResponses?.length > 0 ? (
                  <ul className={styles.responseList}>
                    {question.textResponses.map((response, i) => (
                      <li key={i} className={styles.responseItem}>
                        <span className={styles.responseText}>{response.text_answer}</span>
                        <span className={styles.responseDate}>
                          {new Date(response.created_at).toLocaleDateString('ko-KR')}
                        </span>
                      </li>
                    ))}
                  </ul>
                ) : (
                  <p className={styles.noResponses}>ì•„ì§ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤</p>
                )}
              </div>
            )}
          </div>
        ))}
      </div>

      {isAuthor && (
        <div className={styles.authorActions}>
          <a href={`/surveys/${surveyId}/edit`} className={styles.editButton}>
            ì„¤ë¬¸ ìˆ˜ì •
          </a>
        </div>
      )}
    </div>
  );
}
```

### 8.2 ê²°ê³¼ í˜ì´ì§€ ìŠ¤íƒ€ì¼

#### `app/(main)/surveys/[id]/results/page.module.css`
```css
.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.header {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  margin-bottom: 2rem;
}

.headerTop {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  margin-bottom: 1rem;
}

.title {
  font-size: 1.75rem;
  font-weight: 700;
  color: #1f2937;
  margin: 0;
}

.category {
  background: #4f46e5;
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
}

.description {
  color: #6b7280;
  font-size: 1rem;
  line-height: 1.6;
  margin: 0 0 1rem 0;
}

.meta {
  display: flex;
  gap: 1.5rem;
  font-size: 0.875rem;
  color: #6b7280;
  flex-wrap: wrap;
}

.status {
  font-weight: 600;
  color: #10b981;
}

.statsBox {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 2rem;
  border-radius: 12px;
  margin-bottom: 2rem;
}

.statsBox h2 {
  margin: 0 0 1.5rem 0;
  font-size: 1.25rem;
  font-weight: 700;
}

.statsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 2rem;
}

.statItem {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: 700;
}

.statLabel {
  font-size: 0.875rem;
  opacity: 0.9;
}

.results h2 {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
  margin: 0 0 1.5rem 0;
}

.questionResult {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  margin-bottom: 1.5rem;
}

.questionTitle {
  font-size: 1.125rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 1.5rem 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.questionType {
  background: #f3f4f6;
  color: #6b7280;
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

.chartContainer {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.chartBar {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.barLabel {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.875rem;
  color: #374151;
}

.barStats {
  font-weight: 600;
  color: #4f46e5;
}

.barBackground {
  width: 100%;
  height: 32px;
  background: #f3f4f6;
  border-radius: 8px;
  overflow: hidden;
}

.barFill {
  height: 100%;
  background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
  border-radius: 8px;
  transition: width 0.3s ease;
  min-width: 2%;
}

.textResponses {
  margin-top: 0.5rem;
}

.responseList {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.responseItem {
  background: #f9fafb;
  padding: 1rem;
  border-radius: 8px;
  border-left: 3px solid #4f46e5;
  display: flex;
  justify-content: space-between;
  align-items: start;
  gap: 1rem;
}

.responseText {
  flex: 1;
  color: #1f2937;
  line-height: 1.6;
}

.responseDate {
  font-size: 0.75rem;
  color: #9ca3af;
  white-space: nowrap;
}

.noResponses {
  text-align: center;
  color: #9ca3af;
  padding: 2rem;
  font-size: 0.875rem;
}

.authorActions {
  margin-top: 2rem;
  text-align: center;
}

.editButton {
  display: inline-block;
  background: #4f46e5;
  color: white;
  padding: 0.75rem 2rem;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  transition: background 0.2s;
}

.editButton:hover {
  background: #4338ca;
}

.error,
.accessDenied {
  max-width: 600px;
  margin: 4rem auto;
  padding: 2rem;
  background: white;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  text-align: center;
}

.accessDenied h2 {
  color: #1f2937;
  margin: 0 0 1rem 0;
  font-size: 1.5rem;
}

.accessDenied p {
  color: #6b7280;
  line-height: 1.6;
  margin: 0;
}
```

---

## 9ë‹¨ê³„: ë§ˆì´í˜ì´ì§€ ì—°ë™ (1.5ì‹œê°„)

### 9.1 ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ì¡°íšŒ

#### `app/(main)/my/created/page.js`
```javascript
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import SurveyCard from '@/components/survey/SurveyCard';
import styles from './page.module.css';

export default async function MyCreatedSurveysPage() {
  const supabase = createClient();
  
  // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    redirect('/login');
  }

  // ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ì¡°íšŒ
  const { data: surveys, error } = await supabase
    .from('surveys')
    .select(`
      *,
      profiles:author_id (nickname),
      responses (count)
    `)
    .eq('author_id', user.id)
    .order('created_at', { ascending: false });

  if (error) {
    return <div>ì—ëŸ¬: {error.message}</div>;
  }

  return (
    <div className={styles.container}>
      <h1 className={styles.title}>ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</h1>
      {surveys?.length === 0 ? (
        <div className={styles.empty}>
          <p>ì•„ì§ ë§Œë“  ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          <a href="/surveys/create" className={styles.createLink}>
            ì²« ì„¤ë¬¸ ë§Œë“¤ê¸°
          </a>
        </div>
      ) : (
        <div className={styles.surveyGrid}>
          {surveys?.map(survey => (
            <SurveyCard key={survey.id} survey={survey} showEdit={true} />
          ))}
        </div>
      )}
    </div>
  );
}
```

### 9.2 ë‚´ê°€ ì‘ë‹µí•œ ì„¤ë¬¸ ì¡°íšŒ

#### `app/(main)/my/responded/page.js`
```javascript
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import SurveyCard from '@/components/survey/SurveyCard';
import styles from './page.module.css';

export default async function MyRespondedSurveysPage() {
  const supabase = createClient();
  
  // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    redirect('/login');
  }

  // ë‚´ê°€ ì‘ë‹µí•œ ì„¤ë¬¸ ì¡°íšŒ
  const { data: responses, error } = await supabase
    .from('responses')
    .select(`
      *,
      surveys (
        *,
        profiles:author_id (nickname)
      )
    `)
    .eq('user_id', user.id)
    .order('created_at', { ascending: false });

  if (error) {
    return <div>ì—ëŸ¬: {error.message}</div>;
  }

  // ì„¤ë¬¸ ì •ë³´ë§Œ ì¶”ì¶œ
  const surveys = responses?.map(r => ({
    ...r.surveys,
    responded_at: r.created_at,
  }));

  return (
    <div className={styles.container}>
      <h1 className={styles.title}>ë‚´ê°€ ì‘ë‹µí•œ ì„¤ë¬¸</h1>
      {surveys?.length === 0 ? (
        <div className={styles.empty}>
          <p>ì•„ì§ ì‘ë‹µí•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          <a href="/surveys" className={styles.browseLink}>
            ì„¤ë¬¸ ë‘˜ëŸ¬ë³´ê¸°
          </a>
        </div>
      ) : (
        <div className={styles.surveyGrid}>
          {surveys?.map(survey => (
            <SurveyCard 
              key={survey.id} 
              survey={survey} 
              showRespondedDate={true}
              respondedAt={survey.responded_at}
            />
          ))}
        </div>
      )}
    </div>
  );
}
```

### 9.3 í”„ë¡œí•„ ì¡°íšŒ ë° ìˆ˜ì •

#### `app/(main)/my/profile/page.js`
```javascript
'use client';

import { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
import Button from '@/components/common/Button';
import styles from './page.module.css';

export default function MyProfilePage() {
  const { user } = useAuth();
  const router = useRouter();
  const [profile, setProfile] = useState(null);
  const [nickname, setNickname] = useState('');
  const [schoolName, setSchoolName] = useState('');
  const [isEditing, setIsEditing] = useState(false);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    if (!user) {
      router.push('/login');
      return;
    }
    loadProfile();
  }, [user]);

  const loadProfile = async () => {
    const supabase = createClient();
    
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', user.id)
      .single();

    if (data) {
      setProfile(data);
      setNickname(data.nickname || '');
      setSchoolName(data.school_name || '');
    }
    setLoading(false);
  };

  const handleSave = async () => {
    setSaving(true);
    const supabase = createClient();

    const { error } = await supabase
      .from('profiles')
      .update({
        nickname,
        school_name: schoolName,
      })
      .eq('id', user.id);

    if (error) {
      alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
    } else {
      alert('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤');
      setIsEditing(false);
      loadProfile();
    }
    setSaving(false);
  };

  const handleCancel = () => {
    setNickname(profile.nickname || '');
    setSchoolName(profile.school_name || '');
    setIsEditing(false);
  };

  if (loading) {
    return <div className={styles.loading}>ë¡œë”© ì¤‘...</div>;
  }

  return (
    <div className={styles.container}>
      <div className={styles.profileBox}>
        <h1 className={styles.title}>ë‚´ í”„ë¡œí•„</h1>
        
        <div className={styles.profileInfo}>
          <div className={styles.infoItem}>
            <label>ì´ë©”ì¼</label>
            <p>{user?.email}</p>
          </div>

          <div className={styles.infoItem}>
            <label>ë‹‰ë„¤ì„</label>
            {isEditing ? (
              <input
                type="text"
                value={nickname}
                onChange={(e) => setNickname(e.target.value)}
                maxLength={20}
                className={styles.input}
              />
            ) : (
              <p>{profile?.nickname || 'ë¯¸ì„¤ì •'}</p>
            )}
          </div>

          <div className={styles.infoItem}>
            <label>í•™êµëª…</label>
            {isEditing ? (
              <input
                type="text"
                value={schoolName}
                onChange={(e) => setSchoolName(e.target.value)}
                maxLength={50}
                className={styles.input}
              />
            ) : (
              <p>{profile?.school_name || 'ë¯¸ì„¤ì •'}</p>
            )}
          </div>

          <div className={styles.infoItem}>
            <label>ê°€ì…ì¼</label>
            <p>{new Date(profile?.created_at).toLocaleDateString('ko-KR')}</p>
          </div>
        </div>

        <div className={styles.buttonGroup}>
          {isEditing ? (
            <>
              <Button onClick={handleSave} disabled={saving}>
                {saving ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
              </Button>
              <Button variant="secondary" onClick={handleCancel}>
                ì·¨ì†Œ
              </Button>
            </>
          ) : (
            <Button onClick={() => setIsEditing(true)}>
              í”„ë¡œí•„ ìˆ˜ì •
            </Button>
          )}
        </div>
      </div>

      {/* í†µê³„ ì •ë³´ */}
      <ProfileStats userId={user?.id} />
    </div>
  );
}

function ProfileStats({ userId }) {
  const [stats, setStats] = useState({ created: 0, responded: 0 });

  useEffect(() => {
    loadStats();
  }, [userId]);

  const loadStats = async () => {
    const supabase = createClient();

    // ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ìˆ˜
    const { count: createdCount } = await supabase
      .from('surveys')
      .select('*', { count: 'exact', head: true })
      .eq('author_id', userId);

    // ë‚´ê°€ ì‘ë‹µí•œ ì„¤ë¬¸ ìˆ˜
    const { count: respondedCount } = await supabase
      .from('responses')
      .select('*', { count: 'exact', head: true })
      .eq('user_id', userId);

    setStats({
      created: createdCount || 0,
      responded: respondedCount || 0,
    });
  };

  return (
    <div className={styles.statsBox}>
      <h2>í™œë™ í†µê³„</h2>
      <div className={styles.statsGrid}>
        <div className={styles.statItem}>
          <span className={styles.statNumber}>{stats.created}</span>
          <span className={styles.statLabel}>ë§Œë“  ì„¤ë¬¸</span>
        </div>
        <div className={styles.statItem}>
          <span className={styles.statNumber}>{stats.responded}</span>
          <span className={styles.statLabel}>ì‘ë‹µí•œ ì„¤ë¬¸</span>
        </div>
      </div>
    </div>
  );
}
```

### 9.4 ë§ˆì´í˜ì´ì§€ ë©”ì¸

#### `app/(main)/my/page.js`
```javascript
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import Link from 'next/link';
import styles from './page.module.css';

export default async function MyPage() {
  const supabase = createClient();
  
  // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    redirect('/login');
  }

  // í”„ë¡œí•„ ì •ë³´
  const { data: profile } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', user.id)
    .single();

  // ìµœê·¼ ë§Œë“  ì„¤ë¬¸ (ìµœëŒ€ 3ê°œ)
  const { data: recentCreated } = await supabase
    .from('surveys')
    .select('id, title, created_at')
    .eq('author_id', user.id)
    .order('created_at', { ascending: false })
    .limit(3);

  // ìµœê·¼ ì‘ë‹µí•œ ì„¤ë¬¸ (ìµœëŒ€ 3ê°œ)
  const { data: recentResponded } = await supabase
    .from('responses')
    .select('created_at, surveys(id, title)')
    .eq('user_id', user.id)
    .order('created_at', { ascending: false })
    .limit(3);

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <h1>ì•ˆë…•í•˜ì„¸ìš”, {profile?.nickname || 'ì‚¬ìš©ì'}ë‹˜!</h1>
        <p className={styles.email}>{user.email}</p>
      </div>

      <div className={styles.menuGrid}>
        <Link href="/my/created" className={styles.menuCard}>
          <div className={styles.menuIcon}>ğŸ“</div>
          <h3>ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</h3>
          <p>ìƒì„±í•œ ì„¤ë¬¸ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </Link>

        <Link href="/my/responded" className={styles.menuCard}>
          <div className={styles.menuIcon}>âœ…</div>
          <h3>ì‘ë‹µí•œ ì„¤ë¬¸</h3>
          <p>ì°¸ì—¬í•œ ì„¤ë¬¸ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </Link>

        <Link href="/my/profile" className={styles.menuCard}>
          <div className={styles.menuIcon}>ğŸ‘¤</div>
          <h3>í”„ë¡œí•„ ì„¤ì •</h3>
          <p>ë‚´ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”</p>
        </Link>
      </div>

      {/* ìµœê·¼ í™œë™ */}
      <div className={styles.recentActivity}>
        <section className={styles.activitySection}>
          <h2>ìµœê·¼ ë§Œë“  ì„¤ë¬¸</h2>
          {recentCreated?.length > 0 ? (
            <ul className={styles.activityList}>
              {recentCreated.map(survey => (
                <li key={survey.id}>
                  <Link href={`/surveys/${survey.id}`}>
                    {survey.title}
                  </Link>
                  <span className={styles.date}>
                    {new Date(survey.created_at).toLocaleDateString('ko-KR')}
                  </span>
                </li>
              ))}
            </ul>
          ) : (
            <p className={styles.emptyMessage}>ë§Œë“  ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>
          )}
          <Link href="/my/created" className={styles.viewAll}>
            ì „ì²´ ë³´ê¸° â†’
          </Link>
        </section>

        <section className={styles.activitySection}>
          <h2>ìµœê·¼ ì‘ë‹µí•œ ì„¤ë¬¸</h2>
          {recentResponded?.length > 0 ? (
            <ul className={styles.activityList}>
              {recentResponded.map((item, index) => (
                <li key={index}>
                  <Link href={`/surveys/${item.surveys.id}`}>
                    {item.surveys.title}
                  </Link>
                  <span className={styles.date}>
                    {new Date(item.created_at).toLocaleDateString('ko-KR')}
                  </span>
                </li>
              ))}
            </ul>
          ) : (
            <p className={styles.emptyMessage}>ì‘ë‹µí•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>
          )}
          <Link href="/my/responded" className={styles.viewAll}>
            ì „ì²´ ë³´ê¸° â†’
          </Link>
        </section>
      </div>
    </div>
  );
}
```

### 9.5 SurveyCard ì»´í¬ë„ŒíŠ¸ ê°œì„ 

#### `components/survey/SurveyCard.js` ìˆ˜ì •
```javascript
import Link from 'next/link';
import Button from '@/components/common/Button';
import styles from './SurveyCard.module.css';

export default function SurveyCard({ 
  survey, 
  showEdit = false,
  showRespondedDate = false,
  respondedAt 
}) {
  const {
    id,
    title,
    description,
    category,
    end_date,
    profiles,
  } = survey;

  // ì‘ë‹µ ìˆ˜ ê³„ì‚° (Supabase aggregation)
  const responseCount = survey.responses?.[0]?.count || 0;
  const creatorNickname = profiles?.nickname || 'ìµëª…';

  // D-day ê³„ì‚°
  const getDday = (deadline) => {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const deadlineDate = new Date(deadline);
    deadlineDate.setHours(23, 59, 59, 999);
    
    const diffTime = deadlineDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays < 0) return 'ë§ˆê°';
    if (diffDays === 0) return 'D-Day';
    return `D-${diffDays}`;
  };

  const dday = getDday(end_date);
  const isClosed = dday === 'ë§ˆê°';

  return (
    <div className={`${styles.card} ${isClosed ? styles.closed : ''}`}>
      <div className={styles.header}>
        <span className={styles.category}>{category}</span>
      </div>

      <Link href={`/surveys/${id}`} className={styles.titleLink}>
        <h3 className={styles.title}>{title}</h3>
      </Link>

      <p className={styles.description}>{description}</p>

      <div className={styles.footer}>
        <div className={styles.info}>
          <span className={styles.creator}>ğŸ‘¤ {creatorNickname}</span>
          <span className={styles.deadline}>ğŸ“… {dday}</span>
          <span className={styles.responses}>ğŸ’¬ {responseCount}ëª…</span>
        </div>

        {/* showEditì´ trueì´ë©´ ìˆ˜ì •/ê²°ê³¼ ë²„íŠ¼ í‘œì‹œ */}
        {showEdit ? (
          <div className={styles.editButtons}>
            <Link href={`/surveys/${id}/edit`}>
              <Button size="small">ìˆ˜ì •</Button>
            </Link>
            <Link href={`/surveys/${id}/results`}>
              <Button size="small" variant="secondary">ê²°ê³¼</Button>
            </Link>
          </div>
        ) : (
          <Link href={`/surveys/${id}`} className={styles.button}>
            {isClosed ? 'ê²°ê³¼ë³´ê¸°' : 'ì°¸ì—¬í•˜ê¸°'} â†’
          </Link>
        )}
      </div>

      {/* showRespondedDateê°€ trueì´ë©´ ì‘ë‹µì¼ í‘œì‹œ */}
      {showRespondedDate && respondedAt && (
        <div className={styles.respondedInfo}>
          ì‘ë‹µì¼: {new Date(respondedAt).toLocaleDateString('ko-KR')}
        </div>
      )}
    </div>
  );
}
```

#### CSS ì¶”ê°€ í•„ìš” (`components/survey/SurveyCard.module.css`)
```css
.editButtons {
  display: flex;
  gap: 0.5rem;
}

.respondedInfo {
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  border-top: 1px solid #e5e7eb;
  font-size: 0.85rem;
  color: #6b7280;
  text-align: center;
}
```

---

## 10ë‹¨ê³„: ê´€ë¦¬ì ê¸°ëŠ¥ êµ¬í˜„ (1ì‹œê°„)

### 9.1 ê´€ë¦¬ì ì²´í¬ ë¯¸ë“¤ì›¨ì–´

#### `lib/checkAdmin.js`
```javascript
import { createClient } from '@/lib/supabase/server';

export async function checkAdmin() {
  const supabase = createClient();
  
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) return false;
  
  const { data: profile } = await supabase
    .from('profiles')
    .select('is_admin')
    .eq('id', user.id)
    .single();
  
  return profile?.is_admin === true;
}
```

### 9.2 ê´€ë¦¬ì í˜ì´ì§€ ë³´í˜¸

#### `app/admin/page.js`
```javascript
import { redirect } from 'next/navigation';
import { checkAdmin } from '@/lib/checkAdmin';
import { createClient } from '@/lib/supabase/server';
// ... imports

export default async function AdminPage() {
  const isAdmin = await checkAdmin();
  
  if (!isAdmin) {
    redirect('/');
  }

  const supabase = createClient();

  // í†µê³„ ë°ì´í„°
  const { count: totalUsers } = await supabase
    .from('profiles')
    .select('*', { count: 'exact', head: true });

  const { count: totalSurveys } = await supabase
    .from('surveys')
    .select('*', { count: 'exact', head: true });

  // ... ê¸°ì¡´ JSX
}
```

---

## 10ë‹¨ê³„: ê´€ë¦¬ì ê¸°ëŠ¥ êµ¬í˜„ (1ì‹œê°„)

### 10.1 ê´€ë¦¬ì ì²´í¬ ë¯¸ë“¤ì›¨ì–´

#### `lib/checkAdmin.js`
```javascript
import { createClient } from '@/lib/supabase/server';

export async function checkAdmin() {
  const supabase = createClient();
  
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) return false;
  
  const { data: profile } = await supabase
    .from('profiles')
    .select('is_admin')
    .eq('id', user.id)
    .single();
  
  return profile?.is_admin === true;
}
```

### 10.2 ê´€ë¦¬ì í˜ì´ì§€ ë³´í˜¸

#### `app/admin/page.js`
```javascript
import { redirect } from 'next/navigation';
import { checkAdmin } from '@/lib/checkAdmin';
import { createClient } from '@/lib/supabase/server';
// ... imports

export default async function AdminPage() {
  const isAdmin = await checkAdmin();
  
  if (!isAdmin) {
    redirect('/');
  }

  const supabase = createClient();

  // í†µê³„ ë°ì´í„°
  const { count: totalUsers } = await supabase
    .from('profiles')
    .select('*', { count: 'exact', head: true });

  const { count: totalSurveys } = await supabase
    .from('surveys')
    .select('*', { count: 'exact', head: true });

  // ... ê¸°ì¡´ JSX
}
```

---

## 11ë‹¨ê³„: í…ŒìŠ¤íŠ¸ & ë””ë²„ê¹… (2ì‹œê°„)

### 11.1 ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ì¸ì¦ í…ŒìŠ¤íŠ¸
- [ ] ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‘ë™
- [ ] íšŒì›ê°€ì… í›„ í”„ë¡œí•„ ì €ì¥
- [ ] ë¡œê·¸ì•„ì›ƒ ì‘ë™
- [ ] ì„¸ì…˜ ìœ ì§€ í™•ì¸

#### ì„¤ë¬¸ í…ŒìŠ¤íŠ¸
- [ ] ì„¤ë¬¸ ëª©ë¡ ì¡°íšŒ
- [ ] ì„¤ë¬¸ ìƒì„± (ëª¨ë“  ì§ˆë¬¸ ìœ í˜•)
- [ ] ì„¤ë¬¸ ìƒì„¸ ë³´ê¸°
- [ ] ì„¤ë¬¸ ìˆ˜ì •
- [ ] ì„¤ë¬¸ ì‚­ì œ (soft delete)

#### ì‘ë‹µ í…ŒìŠ¤íŠ¸
- [ ] ê°ê´€ì‹ ë‹¨ì¼ ì„ íƒ ì‘ë‹µ
- [ ] ê°ê´€ì‹ ë³µìˆ˜ ì„ íƒ ì‘ë‹µ
- [ ] ì£¼ê´€ì‹ ì‘ë‹µ
- [ ] ì‘ë‹µ í›„ ì¬ì‘ë‹µ ë°©ì§€
- [ ] ì‘ë‹µ ì œì¶œ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸

#### ê²°ê³¼ í…ŒìŠ¤íŠ¸
- [ ] ê°ê´€ì‹ í†µê³„ ì •í™•ì„±
- [ ] ì£¼ê´€ì‹ ë‹µë³€ ëª©ë¡
- [ ] ë°±ë¶„ìœ¨ ê³„ì‚° ì •í™•ì„±

#### ê¶Œí•œ í…ŒìŠ¤íŠ¸
- [ ] ë³¸ì¸ ì„¤ë¬¸ë§Œ ìˆ˜ì • ê°€ëŠ¥
- [ ] ë³¸ì¸ ì„¤ë¬¸ë§Œ ì‚­ì œ ê°€ëŠ¥
- [ ] ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ ì œí•œ

#### ë§ˆì´í˜ì´ì§€ í…ŒìŠ¤íŠ¸
- [ ] ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ëª©ë¡ ì¡°íšŒ
- [ ] ë‚´ê°€ ì‘ë‹µí•œ ì„¤ë¬¸ ëª©ë¡ ì¡°íšŒ
- [ ] í”„ë¡œí•„ ì •ë³´ ìˆ˜ì •
- [ ] í™œë™ í†µê³„ ì •í™•ì„±

### 11.2 ì¼ë°˜ì ì¸ ì—ëŸ¬ ë° í•´ê²°

#### ì—ëŸ¬: "relation does not exist"
â†’ í…Œì´ë¸”ì´ ìƒì„± ì•ˆ ë¨. SQL ë‹¤ì‹œ ì‹¤í–‰

#### ì—ëŸ¬: "JWT expired"
â†’ ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸

#### ì—ëŸ¬: "Row Level Security policy violation"
â†’ RLS ì •ì±… í™•ì¸ ë° ìˆ˜ì •

#### ì—ëŸ¬: "null value in column violates not-null constraint"
â†’ í•„ìˆ˜ í•„ë“œ ëˆ„ë½. ë°ì´í„° í™•ì¸

---

## ğŸ“š ì¶”ê°€ ìë£Œ

### Supabase ë¬¸ì„œ
- https://supabase.com/docs
- https://supabase.com/docs/guides/auth
- https://supabase.com/docs/guides/database

### Next.js + Supabase ê°€ì´ë“œ
- https://supabase.com/docs/guides/getting-started/quickstarts/nextjs

### ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê°€ì´ë“œ
- https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **í™˜ê²½ ë³€ìˆ˜**: `.env.local`ì€ ì ˆëŒ€ GitHubì— ì»¤ë°‹í•˜ì§€ ë§ ê²ƒ
2. **API í‚¤**: `service_role` í‚¤ëŠ” ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ
3. **RLS**: ëª¨ë“  í…Œì´ë¸”ì— RLS ì •ì±… í•„ìˆ˜ ì ìš©
4. **ì—ëŸ¬ ì²˜ë¦¬**: ëª¨ë“  Supabase í˜¸ì¶œì— ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€
5. **ë¡œë”© ìƒíƒœ**: ë¹„ë™ê¸° ì‘ì—… ì¤‘ ë¡œë”© UI í‘œì‹œ

---

## ğŸ¯ ì™„ë£Œ í›„ í™•ì¸ì‚¬í•­

- [ ] ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì •ìƒ ì‘ë™
- [ ] ì„¤ë¬¸ ìƒì„±/ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
- [ ] ì‘ë‹µ ì œì¶œ ë° ê²°ê³¼ í™•ì¸ ê°€ëŠ¥
- [ ] ê´€ë¦¬ì ê¸°ëŠ¥ ì‘ë™
- [ ] ëª¨ë“  RLS ì •ì±… ì ìš©
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ì™„ë£Œ
- [ ] ë¡œë”© ìƒíƒœ UI ì¶”ê°€

**ë‹¤ìŒ ë‹¨ê³„**: ë°°í¬ ì¤€ë¹„ (Vercel + Supabase Production)
